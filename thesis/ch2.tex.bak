\chapter{Confinement of two species with radically different charge to mass ratio}
\label{chap:math}

\xxx{In this chapter we will build on theory from the first chapter and introduce some new theory as well}

\section{Two frequency quadrupole Paul trap}
\label{sec:two frequency trap}

As was mentioned in the section \ref{sec:spring constant},
we can use two frequencies, each targeting to optimize the trapping of one species. Higher frequency $\Omega_2$
 for trapping electrons, with the potential $V_2$
 applied to the electrode. A lower frequency $\Omega_1$
 with potential $V_1$
 for trapping ions. We proceed in setting up a two-frequency trap as described in \cite{FOOT2018117, trypogeorgos2016cotrapping}. First, we must acknowledge that while higher frequency will have no significant impact on heavier ions, a light electron will experience the slower field to the full extent. Therefore we have to ensure that the trapping of electrons due to the higher frequency field is strong enough to withstand misguiding by the field with a lower frequency. This potential instability is referred to as \emph{parametric excitation}. We can secure that to some extent by feeding potentials on electrodes in such a way that $V_1 \ll V_2$. We can provide potentials up to $V_2 \sim \SI{100}{\volt}$, and $V_1 \sim \SI{5}{\volt}$, in the conditions of our experiment. Assuming that this allows us to look at each frequency setup independently, using \eqref{spring constant}, we get a ratio of spring constants:
\begin{equation}
	\label{two frequency ratio}
	\Kappa = \dfrac{\kappa_{electron}(\Omega_2)}{\kappa_{ion}(\Omega_1)} \approx \dfrac{M_{ion}}{M_{electron}} \left(\dfrac{V_2}{V_1}\dfrac{\Omega_1}{\Omega_2}\right)^2.
\end{equation}
The correct way to create a stable configuration of a two-frequency trap is to begin by finding the optimal parameters for the confinement of lighter species. Optimal trapping in a single frequency trap corresponds to \cite{gerlich1992inhomogeneous} $q_2 \approx 0.4$. Using \eqref{q_2}, with the choice of $V_2 = \SI{100}{\volt}$, we obtain optimal frequency for electron trapping as $\Omega_2 = \SI{1.88e10}{rad.s^{-1}}$. Now, we must choose the $\Omega_1$ and $V_1$ for ion trapping in a way that suppresses parametric heating of electrons. It is crucial to keep the electron's secular frequency higher than the driving frequency for ion confinement. Otherwise, the $\Omega_2$ frequency field would be too slow to save an electron from parametric excitation. So another condition that must be satisfied in two frequency trapping is:
\begin{equation}
	\Omega_1 \ll \omega_2 = \dfrac{\sqrt{2} Q V_2}{M_{electron} \ell_0^2 \Omega_2},
\end{equation}
where the second equality follows from \eqref{secular frequency}. 
 

\xxx{Same criterion for optimal trapping $q_1 \approx 0.4$ gives us frequency $\Omega_1 = \SI{1.55e7}{rad.s^{-1}}$. For such setting we obtain the ratio of spring constants for both species $\Kappa = 20$, which is already a great improvement compared to a single frequency trap.}


\xxx{\dots build a little bridge from the section explaining a single frequency trap. We need two frequencies for particles with widely different charge to mass ratios: $Q_m \equiv \nicefrac{Q}{m}$ \cite{FOOT2018117}.}
In the case of a linear quadrupole with perfectly hyperbolical electrodes with cylindrical symmetry we have a electric potential in the form \cite{leefer2017investigation}
:

\begin{equation}
	V(t, \vb{r}) = \bigg[ V_0 + V_1 cos(\Omega_1 t) + V_2 \cos(\Omega_2 t) \bigg] \frac{x^2 + y^2 - 2 z^2 }{2 \ell_0^2},
\end{equation}
where $V_0$ is an amplitude of static potential, $V_1$ of slower potential and $V_2$ is an amplitude of rapidly oscillating potential on the electrode. The equations of motion for a particle in such potential, after change of variable: $\tau = \nicefrac{t\Omega_2}{2}$ are:

\begin{subequations}
\label{eq of motion for simulation}
\begin{align}
	\ddot{x}(\tau) & = x(\tau) \bigg[ a - 2 q_1 \cos\left(2 \tau \nicefrac{\Omega_1}{\Omega_2} \right) - 2 q_2 \cos(2\tau) \bigg], \\
	\ddot{y}(\tau) & = y(\tau) \bigg[ a - 2 q_1 \cos\left(2 \tau \nicefrac{\Omega_1}{\Omega_2} \right) - 2 q_2 \cos(2\tau) \bigg], \\
	\label{studied eq of motion}
	\ddot{z}(\tau) & = -2z(\tau) \bigg[ a - 2 q_1 \cos\left(2 \tau \nicefrac{\Omega_1}{\Omega_2} \right) - 2 q_2 \cos(2\tau) \bigg],
\end{align}
\end{subequations}
where $a$, $q_1$ and $q_2$ are dimensionless parameters:
\begin{subequations}
\begin{align}
	\label{a}
	a & = 4 \dfrac{Q V_0}{M\Omega_2^2 \ell_0^2}, \\
	\label{q_1}
	q_1 & = -2 \dfrac{Q V_1}{M\Omega_2^2 \ell_0^2}, \\
	\label{q_2}
	q_2 & = -2 \dfrac{Q V_2}{M\Omega_2^2 \ell_0^2}.
\end{align}
\end{subequations}

\section{Floquet theory}
\label{sec:floquet}


Since the particle experiences the weakest confinement in the z-direction, we will examine this equation's properties. Floquet theory is a theory covering linear first-order ODEs with periodic coefficients. These are equations of the form:
\begin{equation}
	\label{Floquet structure}
	\dot{\vb{u}}(\tau) = \tensorq{F}(\tau) \vb{u}(\tau),
\end{equation}
where $\tensorq{F}$ is a matrix valued function with minimal period $T$. Let's illustrate this theory for the case of our differential equation. We begin by rewriting the equation \eqref{studied eq of motion} as a system of two first-order differential equations written in the matrix form:
\begin{align}
\label{matrix mathieu}
	\frac{d}{d \tau}
	\begin{bmatrix}
		z(\tau) \\
		\dot{z}(\tau)
	\end{bmatrix}	
	&=
	\begin{bmatrix}
		0 & 1 \\
		-2\bigg( a - 2 q_1 \cos\left(2 \tau \nicefrac{\Omega_1}{\Omega_2} \right) - 2 q_2 \cos(2\tau) \bigg) & 0	
	\end{bmatrix}
	\begin{bmatrix}
		z(\tau) \\
		\dot{z}(\tau)
	\end{bmatrix},
\end{align}
which already has a structure of \eqref{Floquet structure}. Without the necessity of finding a solution to this system, we can acquire knowledge about its stability. The information we are interested in is whether a solution is bounded for a given set of parameters or not. In this section, we will limit ourselves to the driving frequencies, which can be represented as: $\nicefrac{\Omega_2}{\Omega_1} \equiv \nicefrac{m}{n}$, where $m$ and $n$ are integers and $\nicefrac{m}{n}$ is an irreducible fraction. Then the matrix in equation \eqref{matrix mathieu} is $T = m \pi$ periodic. As in \cite{leefer2017investigation}, we identify the edge of stability regions as a set of parameters for which a solution of \eqref{studied eq of motion} is a $2T$ periodic function\footnote{Note that such stability condition differs from the one we demand while simulating the motion of a particle. The periodic solution of equation of motion implies boundedness, but the value of this boundary might lie outside the physical dimensions of the trap. That is why we ought not to be surprised when we find some differences in stability diagrams, even for the simplest case of a single particle in the trap. \label{foot: different stability condition}} to our problem \eqref{matrix mathieu}. This allows us to seek a solution to our problem in the form:
\begin{equation}
	\label{Floquet ansatz}
	z(\tau) = \sum_{k=-\infty}^{\infty} c_k \exp(i\frac{k}{m}\tau),
\end{equation}
where $c_k$ are constant coefficients. Substituting this into equation \eqref{matrix mathieu} yields an identity:

\begin{multline}
	\sum_{k=-\infty}^{\infty}\left[ \left(a - \dfrac{k^2}{m^2} \right)c_k - q_1 \left(c_{k-2n} + c_{k+2n} \right) - q_2 \left(c_{k-2m} + c_{k+2m} \right)  \right] \\ \exp(i\frac{k}{m}\tau) = 0,
\end{multline}
which holds for every $\tau$ only if each element of the sum is equal to zero. This relation can be written as:

\begin{equation}
	\label{Floquet edge eq}
	\tensorq{F} \cdot \begin{bmatrix}
	\vdots \\
	c_{k-1} \\
	c_{k} \\
	c_{k+1} \\
	\vdots
	\end{bmatrix} = \vb{0},
\end{equation}
where $\tensorq{F}$ is an infinite matrix with elements:

\begin{equation}
	\tensorq{F}_{i j} = \left[ \left(a - \dfrac{k^2}{m^2} \right)\delta_{i j} - q_1 \left(\delta_{i j-2n} + \delta_{i j+2n} \right) - q_2 \left(\delta_{i j-2m} + \delta_{i j+2m} \right)  \right],
\end{equation} 
where:
\begin{equation}
	\delta_{ij} = 
	\begin{cases}
		1 & i=j, \\
		0 & i \neq j.
	\end{cases}	
\end{equation}
The equation \eqref{Floquet edge eq} is equivalent to:
\begin{equation}
	\label{Floquet determinant}
	det(\tensorq{F}) = 0.
\end{equation}
So the determination of stability boils down to computing a determinant of a matrix $\tensorq{F}$. We approximate $\tensorq{F}$ by sufficiently large $\rightarrow (10m+1) \times (10m+1)$ finite matrix. For the index $k$ in previous equations it means: $$k \in \{ -5m, \ -5m+1, \  \cdots, \ 5m-1, \ 5m \} \subset \Z,$$ neglecting solutions with smaller periods. Parameters for which $det(\tensorq{F}) > 0$ were identified as stable and for $det(\tensorq{F}) < 0$ as unstable.
 	
\section{Simulation}
\label{sec:simulation}

Let us begin this section by summarizing our approximations, some of which we have already applied while deriving the equation of motion. We follow mainly the overview from \cite{Friedman_1982}. Starting with insignificant neglections and moving towards more problematic ones. 
\begin{description}
	\item[Gravitational interaction:] neglecting gravitational interaction goes without saying since, for Ca+ ions, it is weaker than electrostatic force by order of $\sim 10^{32}$.
	\item[Relativistic effects:] we did not involve any relativistic corrections since we usually deal with small velocities while trapping particles. Ca+ ions are Doppler cooled down to energies of $\sim \SI{e-4}{\eV}$. The fastest simulated electrons had a kinetic energy of $\sim \SI{1}{\eV}$, for which the relativistic gamma factor is still $\gamma \approx  1$ up to the fifth decimal place.
	\item[Ion radiation:] a well-known consequence of Maxwell equations is that accelerating charged particle emits electromagnetic radiation. We did not account for this energetic loss due to the relatively small force applied to particles in a trap. The power $[P] = [Watt]$ of such radiation can be for our non-relativistic case calculated using \cite{larmor1897lxiii} the Larmor formula: $$P = \dfrac{Q^2 a_c^2}{6 \pi \varepsilon_0 c^3},$$ where $c$ is a speed of light, $\vb{a_c}$ denotes the acceleration of a particle at the given time, and $\varepsilon_0$ is the vacuum permittivity. We can easily estimate the upper bound of acceleration by considering the maximal reasonable value of each term in the equation \eqref{eq of motion for simulation}\footnote{Note that for this set of parameters are all solutions already fully unstable}: $r = \ell_0$, $cos = 1$, $a = 0$, $q_1 = 0.1$ and $q_2 = 0.5$. We get:  $$a_c^{max} \approx \SI{1.8e-3}{m.s^{-2}},$$ which means that the maximal power of radiation was: $$P^{max} = \SI{2e-59}{\watt}.$$ Considering such a constant energy loss, it would take an electron $\sim\num{3e33}$ years to radiate the energy of $\SI{1}{\electronvolt}$.%$\varepsilon_0 = \SI{8.85e-12}{m^{-3}.kg^{-1}.s^{4}.A^{2}}$
	\item[Magnetic field:] Let us begin by writing full form Maxwell's equations in the vacuum:
\begin{subequations}
\label{full maxwell}
\begin{align}
	\label{full gauss}
	\nabla \cdot \vb{E} &= \dfrac{\rho}{\varepsilon_0}, \\
	\label{full faraday}
	\nabla \times \vb{E} &= -\dfrac{\partial\vb{B}}{\partial t}, \\
	\label{full magnet}
	\nabla \cdot \vb{B} &= 0, \\
	\label{full ampere}
	\nabla \times \vb{B} &= \dfrac{1}{c^2}\dfrac{\partial\vb{E}}{\partial t}.
\end{align}
\end{subequations}
We are using quasistatical form instead:
\begin{subequations}
\label{static maxwell}
\begin{align}
	\label{static gauss}
	\nabla \cdot \vb{E} &= 0, \\
	\label{static faraday}
	\nabla \times \vb{E} &= \vb{0}, \\
	\label{static magnet}
	\nabla \cdot \vb{B} &= 0, \\
	\label{static ampere}
	\nabla \times \vb{B} &= \vb{0}.
\end{align}
\end{subequations}
\todo{finish this} 
  
	\item[Induced charge on the electrodes:] charged particles induce surface charge density on the electrodes. This causes attraction of a particle toward the electrode, which can contribute to vacation of the particle from the trap. For reference we can look at simplified situation of a charged particle near an infinite conductive plane. An average acceleration of an electron throughout the stable simulated trajectory was in the order of $\bar{a}_c \sim 10^{17}$. For an infinite conductor to cause an acceleration $\sim \nicefrac{\bar{a}_c}{100}$, the electron would have to approach the electrode up to the distance of $\approx \SI{0.25}{\micro\meter}$, which would already be outside our definition of stable trajectory. Hence we can omit such an effect. 
	\item[Creation of Rydberg atoms:] \xxx{An electron can get caught in some highly excited ion orbital creating a Rydberg atom. The electron can subsequently drop to a lower but still very unstable orbital and vacate from it, losing energy by the associated photon emission. It might be necessary to add such a process to our simulation in the future.}
	\item[Phase shift:] induced by the finite speed of electric signal delivered to the electrode. This could be problematic since the characteristic dimension of our trap is $\ell_0 = \SI{0.5}{\mm}$, and we are using frequencies up to the orders of $\Omega_2 \sim \SI{e10}{rad.s^{-1}}$. Suppose we optimistically assume that the signal travels through the electrode with the speed of light. In that case, the signal in one period $\nicefrac{1}{\Omega_2}$ spans over the distance of $\sim \SI{0.03}{\mm}$, which is getting close to our characteristic length. We tackle this problem by dividing our electrodes into eight sections, see \ref{fig:Real trap geometry 1}, each with its own feeding from the power source.
	\item[Collisions with neutrals:] \xxx{we will be able to make a vacuum with pressure of (no idea and not sure it it can produce significant problems)}
\end{description}	


\subsection{Choice of time-step}

We have tried several integration methods when numerically solving our equations of motion, whether with exact or effective potential.
Choice of time-step is always a delicate issue. For the case of solving the Mathieu-type equation, we followed the Nyquist criterion \xxx{\cite{1697831}}. Nyquist criterion is used mainly in signal processing for compact signals with convergent Fourier series. It states that for the signal with the highest frequency $f$, the largest possible sample size so that the discretization of the signal will carry equivalent information as the continuous one is $\nicefrac{1}{(2 \textit{f})}$. We started numerically solving the equation of motion with this time step, gradually increasing its size until the numerical solution with the denser sampling would give us the same result for the given tolerance. Repeating this process for several methods \footnote{All tried methods can be found in the file \textit{intMethods.py}} for numerical solving of ODEs \cite{teukolsky1992numerical}. For the case of a single electron in the trap with the expected initial conditions \textit{thisOne.dat} had the best performance a predictor-corrector method, which we have defined as \textit{StepEulerAdvanced}. The sufficient time-step for this method was $\Delta t = \nicefrac{1}{(5 \textit{f})}$. \todo{\textbackslash verb doesn't work for some reason that's why are names of the files are currently in italics}

\subsection{Treatment of laser cooling}
In our simulation, we treated the effect of laser cooling of ions by introducing a new frictional force, meaning it is proportional to $\propto - \vb{\dot{r}}$. The strength of this force is characterized by the parameter $\beta \in (0,1)$. 
Let us begin this section by summarizing our approximations (inspired by \cite{Friedman_1982}) when deriving the equation of motion. 

\subsection{Simulating Coulomb crystal}
We simulated Coulomb crystal by molecular dynamics, meaning we solved the equation of motion for each ion in effective potential with Coulomb interaction. 
We simulated the creation of a Coulomb crystal by molecular dynamics while keeping an eye on the total potential energy. We solved an equation of motion for each ion in effective potential with Coulomb interaction and laser cooling represented by the damping factor. We have used damping parameter $\beta$ large enough to decelerate the particles within a computationally reasonable time. To ensure that the ions had enough time to find a potential minimum, they were given a synthetic boost in kinetic energy every time they were slowed down to the minimal temperature, which can be obtained by laser cooling \xxx{(about \SI{0.01}{Kelvin})}. \todo{might be good idea to implement some simplex based algorithm with the molecular dynamics}

\subsection{The code}
The practical part of this thesis consists of developing the code simulating the motion of ions and electrons in a two frequency Paul trap. We have chosen the programming language python for its current popularity allied with an abundance of highly optimized libraries and a good combination of computational and development costs. The source code can be found at \href{https://github.com/rendeka/Bachelor_thesis.git}{github\footnote{$https://github.com/rendeka/Bachelor\_thesis.git$}.} \xxx{Main features of the program are:
\begin{itemize}
	\item Creating a Coulomb crystal.
	\item Making stability diagram in dependence on $q_1$ and $q_2$ parameters.
	\item Parallelizing the computation of stability diagram. 
	\item Optimizing the algorithm to compute stability only on the edge of stability regions.
	\item Tracking the information about the system: positions, velocities, energies
	\item Producing graphical outcomes.
\end{itemize}
I think it would be beneficial to explain, for example what I mean by "optimizing," but I do not think it belongs here. I will probably put it into the appendix.
} 